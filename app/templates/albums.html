{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}{{ user.name }} - 翻相册{% endblock %}
{% block head %}
{{ super() }}
<style>

.album {
    width: 300px;
    padding: 10px;
    margin: 30px 60px 20px 60px;
}



.post h5 {
    color: #333;
  margin-bottom: 9px;
}

.info {
	padding:4px;
}

.thumbnail {
  position: relative;
  width: 270px;
  height: 220px;
  overflow: hidden;
}
.thumbnail img {
  position: absolute;
  left: 50%;
  top: 50%;
  height: 100%;
  width: auto;
  -webkit-transform: translate(-50%,-50%);
      -ms-transform: translate(-50%,-50%);
          transform: translate(-50%,-50%);
}
.thumbnail img.portrait {
  width: 100%;
  height: auto;
}

#likes {
    color: red;
}

.user-area {
    background: #ffe6b3;
    padding: 20px;
}

.data-area {
    
    background: #e6ccff;
    padding: 20px;
    
}

.about-area {
    background: #d6f5d6;
    padding: 20px;
}

.album-cover, .album-cover:before
{
    background: transprent;
    width: 265px;
    height: 215px;
    margin: 5px;
    border: 3px solid #FFF;
    box-shadow: 0 0 0 1px #999;
    position: relative;
}
.album-cover:before
{
    margin: 0;
    content: "";
    position: absolute;
    top: -7px;
    left: -7px;
    background: white;
    z-index: -1;
}


ul.comments {
    list-style-type: none;
    padding: 0px;
    margin: 16px 0px 0px 0px;
}
ul.comments li.comment {
    padding: 8px;
    border-bottom: 1px solid #e0e0e0;
}
ul.comments li.comment:nth-child(1) {
    border-top: 1px solid #e0e0e0;
}
ul.comments li.comment:hover {
    background-color: #f0f0f0;
}
div.comment-date {
    float: right;
}
div.comment-author {
    font-weight: bold;
}
div.comment-thumbnail {
    position: absolute;
}
div.comment-content {
    margin-left: 48px;
    min-height: 48px;
}
div.comment-form {
    margin: 16px 0px 16px 32px;
}

.user-area h2 {
    display: inline;
}

</style>
{% endblock %}

{% block page_content %}

<ol class="breadcrumb">
    <li><a href="{{ url_for('.index') }}">翻相册</a></li>
    <li class="active">{% if current_user == user %}我{% else %}{{ user.name }}{% endif %}的相册</li>
    <li><a href="{{ url_for('main.likes', username=user.username) }}">{% if current_user == user %}我{% else %}{{
        user.name }}{% endif %}的喜欢</a></li>
    {% if user == current_user %}
    <li class="pull-right"><a href="{{ url_for('.edit_profile') }}">编辑资料</a></li>
    {% endif %}
    {% if current_user.is_administrator() %}
    <li class="pull-right"><a href="{{ url_for('.edit_profile_admin', id=user.id) }}">编辑 [Admin]</a></li>
    {% endif %}
</ol>

<div class="row">
    
    
    <div class="col-md-9">
        
        <div class="text-center container-fluid">
            {% if album_count == 0 %}
            {% if current_user == user %}
            <h3>你还没有相册，快来<a href="{{ url_for('.new_album') }}">创建</a>一个吧！</h3>
            {% else %}
            <h3>他/她还没有创建相册。</h3>
            {% endif %}
            {% endif %}
            <div class="row text-center">
                {% for album in albums %}
                {% if not album.no_public or current_user == user%}
                <div class="album col-md-3">
                    <div class="album-cover">
                        <a class="thumbnail" href="{{ url_for('.album', id=album.id) }}">
                            <img class="img-responsive portrait" src="{{ album.cover }}">
                        </a>
                    </div>
                    <div class="info">
                        <h5><a href="{{ url_for('.album', id=album.id) }}">{{ album.title }}</a></h5>
                        <span>{{ album.photos.count() }}张图片</span>
                        <span>创建于{{ moment(album.timestamp).format('L') }}</span>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    
    
    <div class="container-fluid col-md-3">
        <div class="center-text user-area text-center">
            <p>
                <img class="img-rounded user-icon" src="{{ user.gravatar(size=64) }}">
            </p>
            <h2>{{ user.name }}</h2> <i id="likes" class="glyphicon glyphicon-heart"></i> {{ user.liked }}
            {% if user.status %}<p>{{ user.status }}</p>{% endif %}
        
        
        {% if current_user.is_authenticated and user != current_user and user.is_following(current_user) %}
        | <span class="label label-default">他/她在关注你</span>
        {% endif %}
        {% if user != current_user %} <!--current_user.can(Permission.FOLLOW) and -->
        {% if not current_user.is_authenticated or not current_user.is_following(user) %}
        <a href="{{ url_for('.follow', username=user.username) }}" class="btn btn-primary">关注</a>
        {% else %}
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">
                已关注
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="{{ url_for('.unfollow', username=user.username) }}">取消关注</a></li>
            </ul>
        </div>
        {% endif %}
        {% endif %}
        </div>
        
        <hr>
        <div class="data-area">
            <i class="glyphicon glyphicon-user"></i>
            关注者<a href="{{ url_for('.followers', username=user.username) }}"><span class="badge">{{ user.followers.count() }}</span></a>
             <br>
            <i class="glyphicon glyphicon-user"></i>
            关注了<a href="{{ url_for('.followed_by', username=user.username) }}"><span class="badge">{{ user.followed.count() }}</span></a>个人
            <br>
            <i class="glyphicon glyphicon-th-large"></i> 相册{{ album_count }}
            <br>
            <i class="glyphicon glyphicon-picture"></i> 照片{{ photo_count }}
            <br>
            {% if user.location %}
                <i class="glyphicon glyphicon-map-marker"></i>
                <a href="http://maps.google.com/?q={{ user.location }}">{{ user.location }}</a>
            {% endif %}
            {% if current_user.is_administrator() %}
                <a href="mailto:{{ user.email }}">{{ user.email }}</a>
            {% endif %}<br>
            {% if user.website %}
                <i class="glyphicon glyphicon-link"></i>
                <a href="{{ user.website }}" target="_blank">{{ user.website }}</a>
            {% endif %}
            <br>
            <i class="glyphicon glyphicon-repeat"></i>
            {{ moment(user.member_since).format('YYYY/M') }}加入
        </div>
        
       {% if user.about_me %}
         <hr>
        <div class="about-area">
            {{ user.about_me|safe }}
        </div>
        {% endif %}
    </div>
</div>

<div class="text-center">
    {{ macros.pagination_widget(pagination, '.albums', username=user.username) }}
</div>
<hr>

<div class="row">
    <h3>留言板</h3>
    {{ wtf.quick_form(form) }}
    <div id="comment">
        {% include '_comments.html' %}
    </div>
</div><br>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/isotope.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/imagesloaded.js') }}"></script>
<script>
  $('#posts').imagesLoaded( function(){
    $('#posts').isotope({
      itemSelector : '.item'
    });
  });


</script>
{% endblock %}